<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Quaderno Finanze Personali</title>
  <style>
    /* ---------- STILE QUADERNO ---------- */
    :root{
      --line-height: 28px;
      --line-color: #c6d3e6;
      --paper-bg: #fbfbfc;
    }
    *{box-sizing:border-box;font-family:"Courier New",monospace;margin:0;padding:0}
    body{
      padding:2rem;
      background:repeating-linear-gradient(var(--paper-bg) 0 var(--line-height),var(--line-color) var(--line-height) calc(var(--line-height)+1px));
      color:#222;
    }
    h1{text-align:center;margin-bottom:2rem;font-size:2rem;letter-spacing:1px}
    .container{max-width:1200px;margin:0 auto}

    /* ---------- CARDS ---------- */
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-bottom:2rem}
    .card{background:#ffffff88;border:1px solid #7a7a7a;padding:1rem;border-radius:8px;text-align:center}
    .card h2{font-size:0.9rem;color:#444;margin-bottom:0.3rem}
    .card p{font-size:1.4rem;font-weight:700}
    .income-color{color:#2e7d32}
    .expense-color{color:#c62828}

    /* ---------- TABLES ---------- */
    table{width:100%;border-collapse:collapse;background:#ffffffaa;border:1px solid #7a7a7a;margin-bottom:3rem}
    thead{background:#3c3c3c;color:#fff}
    th,td{padding:0.5rem;text-align:center;font-size:0.9rem}
    tbody tr:nth-child(even){background:#f7f7f7bb}
    tbody td.income{color:#2e7d32;font-weight:600}
    tbody td.expense{color:#c62828;font-weight:600}
    tbody td.balance{font-weight:700}
    h2{margin:1.8rem 0 0.6rem;font-size:1.2rem;text-decoration:underline;}

    .month-sep td{background:#d0d7e6;font-weight:700;text-align:left;font-size:1rem;padding-left:0.4rem}
  </style>
</head>
<body>
  <h1>Prospetto Entrate &amp; Uscite</h1>
  <div class="container">
    <section id="summary-cards" class="cards"></section>
    <h2>Riepilogo Mensile</h2>
    <table id="monthly-table"><thead><tr><th>Mese</th><th>Entrate</th><th>Uscite</th><th>Saldo Finale</th></tr></thead><tbody></tbody></table>
    <h2>Dettaglio Transazioni</h2>
    <table id="transactions-table"><thead><tr><th>Data</th><th>Categoria</th><th>Tipo</th><th>Importo</th><th>Saldo dopo operazione</th></tr></thead><tbody></tbody></table>
  </div>

<script>
/*************** PARAMETRI ***************/
const startBalance = 6100;                    // saldo 24‑06‑2025
const startDate    = new Date("2025-06-24");
const endDate      = new Date("2026-12-31");

const lastDay = (y,m) => new Date(y, m+1, 0).getDate();

/* === ABBONAMENTI RICORRENTI === */
const subscriptions = [
  {cat:"Netflix",        amt:19, day:26, from:"2025-06"},
  {cat:"Will",           amt:7,  day:28, from:"2025-06"},
  {cat:"ChatGPT",        amt:23, day:22, from:"2025-06"},
  {cat:"NowTV",          amt:5,  day:19, from:"2025-07"},
  {cat:"Spotify",        amt:15, day:20, from:"2025-07"},
  {cat:"Prime Video AD", amt:2,  day:16, from:"2025-07"},
  {cat:"iCloud",         amt:10, day:23, from:"2025-07"},
  {cat:"YouTube+",       amt:9,  day:11, from:"2025-07"},
  {cat:"Prime",          amt:5,  day:16, from:"2025-07"}
];

/* === SPESE/ENTRATE UNA‑TANTUM === */
const oneOff = [
  {date:"2025-06-27",cat:"Aereo Sicilia", amt:53,  type:"Spesa"},
  {date:"2025-07-12",cat:"Beat Canzone",  amt:35,  type:"Spesa"},
  {date:"2025-08-12",cat:"Beat Canzone",  amt:35,  type:"Spesa"},
  {date:"2025-07-16",cat:"Mix Canzone",   amt:27,  type:"Spesa"},
  {date:"2025-08-16",cat:"Mix Canzone",   amt:27,  type:"Spesa"},
  {date:"2025-07-27",cat:"Aereo Sicilia", amt:53,  type:"Spesa"},
  {date:"2025-08-10",cat:"Rimborso 730",  amt:400, type:"Entrata"},
  {date:"2025-07-15",cat:"Tredicesima",   amt:1300,type:"Entrata"}
];

/* === RATE FINANZIAMENTO === */
const loan = [
  "2025-07-01","2025-08-01","2025-09-01","2025-10-01"
].map(d=>({date:d,cat:"Finanziamento",amt:39,type:"Spesa"}));

/************ GENERA TRANSAZIONI ************/
const tx=[];
const add=(d,cat,type,amt)=>tx.push({date:d,category:cat,type,amount:amt});

[...oneOff,...loan].forEach(o=>add(o.date,o.cat,o.type,o.amt));

let cur = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
while(cur<=endDate){
  const y=cur.getFullYear();
  const m=cur.getMonth();
  const iso=`${y}-${String(m+1).padStart(2,'0')}`;

  // Entrate fisse da luglio 2025
  if(cur>=new Date("2025-07-01")){
    add(`${iso}-01`, "Stipendio", "Entrata", 1650);
    add(`${iso}-01`, "Ticket Edenred", "Entrata", 160);
  }
  // Affitto
  add(`${iso}-${lastDay(y,m)}`, "Affitto", "Spesa", 680);
  // ATM tranne agosto 2025
  if(iso!=="2025-08") add(`${iso}-${lastDay(y,m)}`, "ATM", "Spesa", 39);
  // Tabacco 4 volte
  [5,12,19,26].forEach(d=>{ if(d<=lastDay(y,m)) add(`${iso}-${String(d).padStart(2,'0')}`,"Tabacco","Spesa",20);} );
  // Abbonamenti
  subscriptions.forEach(s=>{
    if(iso>=s.from){
      const day=Math.min(s.day,lastDay(y,m));
      add(`${iso}-${String(day).padStart(2,'0')}`, s.cat, "Spesa", s.amt);
    }
  });

  cur.setMonth(m+1);
}

// Ordina
tx.sort((a,b)=> new Date(a.date)-new Date(b.date));

/*********** CALCOLA SALDI ***********/
let balance=startBalance;
const monthly={};
tx.forEach(t=>{
  balance += t.type==="Entrata"? t.amount : -t.amount;
  t.balance=balance;
  const m=t.date.slice(0,7);
  if(!monthly[m]) monthly[m]={in:0,out:0,saldo:0};
  if(t.type==="Entrata") monthly[m].in+=t.amount; else monthly[m].out+=t.amount;
  monthly[m].saldo=balance;
});

const eur=v=>`€ ${Math.round(v).toLocaleString('it-IT')}`;

/********** RENDER **********/
// Cards
const cardWrap=document.getElementById('summary-cards');
[["Saldo iniziale",startBalance],["Entrate totali",Object.values(monthly).reduce((s,m)=>s+m.in,0),"income-color"],["Uscite totali",Object.values(monthly).reduce((s,m)=>s+m.out,0),"expense-color"],["Saldo corrente",balance]].forEach(([l,v,cls])=>{
  const d=document.createElement('div');d.className='card';d.innerHTML=`<h2>${l}</h2><p class="${cls||''}">${eur(v)}</p>`;cardWrap.appendChild(d);
});

// Monthly table
const mBody=document.querySelector('#monthly-table tbody');
Object.keys(monthly).sort().forEach(m=>{
  const {in:inn,out,saldo}=monthly[m];
  const tr=document.createElement('tr');
  tr.innerHTML=`<td>${m}</td><td class="income">${eur(inn)}</td><td class="expense">${eur(out)}</td><td class="balance">${eur(saldo)}</td>`;
  mBody.appendChild(tr);
});

// Transactions
const tBody=document.querySelector('#transactions-table tbody');
let current="";
tx.forEach(t=>{
  const m=t.date.slice(0,7);
  if(m!==current){
    current=m;
    const sep=document.createElement('tr');sep.className='month-sep';
    const label=new Date(`${m}-01`).toLocaleDateString('it-IT',{month:'long',year:'numeric'});
    sep.innerHTML=`<td colspan="5">${label.charAt(0).toUpperCase()+label.slice(1)}</td>`;
    tBody.appendChild(sep);
  }
  const row=document.createElement('tr');
  row.innerHTML=`<td>${t.date}</td><td>${t.category}</td><td>${t.type}</td><td class="${t.type==='Entrata'?'income':'expense'}">${eur(t.amount)}</td><td class="balance">${eur(t.balance)}</td>`;
  tBody.appendChild(row);
});
</script>
</body>
</html>
